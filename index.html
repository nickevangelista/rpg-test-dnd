<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grim√≥rio do Bardo</title>
    <style>
        :root {
            --bg-color: #1a1a1d;
            --card-bg: #2d2d33;
            --accent: #c3073f; /* Vermelho Bardo */
            --text: #e0e0e0;
            --slot-ready: #6f2232;
            --slot-spent: #1a1a1d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        h1, h2, h3 { color: var(--accent); margin-bottom: 10px; }
        
        /* Container Principal */
        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* Status do Personagem */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .stat-box { text-align: center; }
        .stat-val { font-size: 1.5em; font-weight: bold; display: block;}
        .stat-label { font-size: 0.8em; color: #aaa; }

        /* Slots de Magia */
        .slots-section {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .slot-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
        }
        
        .slot-level-label { width: 80px; font-weight: bold; }
        
        .slot-bubbles { display: flex; gap: 8px; flex-wrap: wrap; }
        
        .slot-bubble {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 2px solid var(--accent);
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .slot-bubble.ready { background-color: var(--accent); box-shadow: 0 0 5px var(--accent); }
        .slot-bubble.spent { background-color: transparent; border-color: #555; }

        /* Lista de Magias */
        .spell-list { list-style: none; padding: 0; }
        
        .spell-card {
            background: var(--card-bg);
            border-left: 5px solid var(--accent);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .spell-info h3 { margin: 0 0 5px 0; font-size: 1.1em; color: #fff; }
        .spell-info p { margin: 0; font-size: 0.9em; color: #aaa; }
        
        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:disabled { background: #555; cursor: not-allowed; }
        
        .btn-cast { margin-left: 10px; }
        .btn-rest { width: 100%; padding: 15px; background: #4e4e50; margin-bottom: 20px; }
        .btn-add { background: #1a73e8; margin-bottom: 20px; width: 100%; padding: 10px;}

        /* Modal de Adicionar */
        #modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
        }
        input, select {
            width: 100%; padding: 10px; margin: 5px 0 15px 0;
            background: #222; border: 1px solid #444; color: white;
            box-sizing: border-box; /* Garante que padding n√£o estoure width */
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1><span id="char-name">Bardo</span> <small style="font-size:0.5em; color:#aaa">Nvl <span id="char-level">5</span></small></h1>
    </header>

    <div class="stats-bar">
        <div class="stat-box">
            <span class="stat-val" id="hp-display">38</span>
            <span class="stat-label">HP M√°x</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="ac-display">14</span>
            <span class="stat-label">AC</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="dc-display">15</span>
            <span class="stat-label">DC Magia</span>
        </div>
    </div>

    <button class="btn-rest" onclick="longRest()">üí§ Descanso Longo (Recuperar Tudo)</button>

    <div class="slots-section" id="slots-container">
        </div>

    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Grim√≥rio</h2>
    </div>
    <button class="btn-add" onclick="openModal()">+ Nova Magia</button>
    
    <ul class="spell-list" id="spell-list">
        </ul>
</div>

<div id="modal">
    <div class="modal-content">
        <h3>Adicionar Magia</h3>
        <label>Nome:</label>
        <input type="text" id="new-spell-name" placeholder="Ex: Fireball">
        
        <label>N√≠vel (0 = Truque):</label>
        <select id="new-spell-level">
            <option value="0">Truque</option>
            <option value="1">N√≠vel 1</option>
            <option value="2">N√≠vel 2</option>
            <option value="3">N√≠vel 3</option>
            <option value="4">N√≠vel 4</option>
            <option value="5">N√≠vel 5</option>
            <option value="6">N√≠vel 6</option>
            <option value="7">N√≠vel 7</option>
            <option value="8">N√≠vel 8</option>
            <option value="9">N√≠vel 9</option>
        </select>

        <label>Descri√ß√£o curta:</label>
        <input type="text" id="new-spell-desc" placeholder="Dano, alcance, etc...">

        <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="saveNewSpell()" style="flex:1; background:var(--accent)">Salvar</button>
            <button onclick="closeModal()" style="flex:1; background:#555">Cancelar</button>
        </div>
    </div>
</div>

<script>
    // --- Dados Iniciais (Configura√ß√£o padr√£o) ---
    const defaultData = {
        name: "Adrian Duvell",
        level: 5,
        stats: { hp: 38, ac: 14, dc: 15 },
        // Configura√ß√£o de Slots Maximos por N√≠vel (D&D 5e Bardo Nvl 5)
        slotsMax: { 1: 4, 2: 3, 3: 2, 4: 0, 5: 0, 6:0, 7:0, 8:0, 9:0 },
        // Slots gastos atualmente (0 = nenhum gasto)
        slotsSpent: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6:0, 7:0, 8:0, 9:0 },
        spells: [
            { id: 1, name: "Vicious Mockery", level: 0, desc: "1d4 Ps√≠quico + Desvantagem" },
            { id: 2, name: "Healing Word", level: 1, desc: "1d4 + Mod (B√¥nus Action)" },
            { id: 3, name: "Shatter", level: 2, desc: "3d8 Trov√£o em √°rea" }
        ]
    };

    // Vari√°vel global de estado
    let data = {};

    // --- Core Functions ---

    function init() {
        const saved = localStorage.getItem('bardoData');
        if (saved) {
            data = JSON.parse(saved);
        } else {
            data = JSON.parse(JSON.stringify(defaultData)); // Deep copy
        }
        render();
    }

    function saveData() {
        localStorage.setItem('bardoData', JSON.stringify(data));
        render();
    }

    function longRest() {
        if(confirm("Fazer descanso longo? Todos os slots ser√£o recuperados.")) {
            // Zera os gastos
            for (let lvl in data.slotsSpent) {
                data.slotsSpent[lvl] = 0;
            }
            saveData();
        }
    }

    function castSpell(level) {
        if (level === 0) {
            alert("Truques n√£o gastam slots!");
            return;
        }
        
        // Verifica se tem slot disponivel
        if (data.slotsSpent[level] < data.slotsMax[level]) {
            data.slotsSpent[level]++;
            saveData();
        } else {
            alert(`Sem slots de N√≠vel ${level} dispon√≠veis! Tente um n√≠vel superior.`);
        }
    }

    // Fun√ß√£o para clicar na bolinha do slot manualmente
    function toggleSlot(level, index) {
        // Se clicar numa bolinha gasta, recupera. Se clicar numa cheia, gasta.
        // Simplifica√ß√£o: Clicar na linha adiciona ou remove gastos.
        // Melhor UX: Vamos apenas renderizar. O bot√£o "Lan√ßar" na magia √© o principal.
        // Mas para controle manual:
        
        // Se o slot clicado (index) for menor que o n√∫mero de slots disponiveis atuais
        // Significa que cliquei num slot "vivo" -> gasta ele.
        const available = data.slotsMax[level] - data.slotsSpent[level];
        
        if (index < available) {
            // Gastar
            data.slotsSpent[level]++;
        } else {
            // Recuperar
            data.slotsSpent[level]--;
        }
        saveData();
    }

    // --- Renderiza√ß√£o (HTML Generation) ---

    function render() {
        document.getElementById('char-name').innerText = data.name;
        document.getElementById('char-level').innerText = data.level;
        document.getElementById('hp-display').innerText = data.stats.hp;
        document.getElementById('ac-display').innerText = data.stats.ac;
        document.getElementById('dc-display').innerText = data.stats.dc;

        // Render Slots
        const slotsContainer = document.getElementById('slots-container');
        slotsContainer.innerHTML = '<h3>Espa√ßos de Magia</h3>';
        
        let hasSlots = false;
        for (let i = 1; i <= 9; i++) {
            if (data.slotsMax[i] > 0) {
                hasSlots = true;
                const row = document.createElement('div');
                row.className = 'slot-row';
                
                const label = document.createElement('div');
                label.className = 'slot-level-label';
                label.innerText = `N√≠vel ${i}`;
                
                const bubblesDiv = document.createElement('div');
                bubblesDiv.className = 'slot-bubbles';

                const total = data.slotsMax[i];
                const spent = data.slotsSpent[i];
                const available = total - spent;

                // Renderiza bolinhas
                // Ordem visual: Bolinhas cheias primeiro
                for (let j = 0; j < total; j++) {
                    const bubble = document.createElement('div');
                    // Se j < available, √© um slot pronto. Se n√£o, est√° gasto.
                    const isReady = j < available;
                    
                    bubble.className = `slot-bubble ${isReady ? 'ready' : 'spent'}`;
                    bubble.onclick = () => toggleSlot(i, j); // Permite clique manual
                    bubblesDiv.appendChild(bubble);
                }

                row.appendChild(label);
                row.appendChild(bubblesDiv);
                slotsContainer.appendChild(row);
            }
        }
        if(!hasSlots) slotsContainer.innerHTML += "<p style='color:#777'>Nenhum slot configurado.</p>";

        // Render Spells
        const list = document.getElementById('spell-list');
        list.innerHTML = '';
        
        // Ordenar: Truques primeiro, depois por n√≠vel
        data.spells.sort((a, b) => a.level - b.level);

        data.spells.forEach((spell, index) => {
            const li = document.createElement('li');
            li.className = 'spell-card';
            
            const levelText = spell.level === 0 ? "Truque" : `N√≠vel ${spell.level}`;
            const isCastable = spell.level === 0 || (data.slotsMax[spell.level] - data.slotsSpent[spell.level] > 0);

            li.innerHTML = `
                <div class="spell-info">
                    <h3>${spell.name} <small style="font-size:0.7em; color:var(--accent)">(${levelText})</small></h3>
                    <p>${spell.desc}</p>
                </div>
                <button class="btn-cast" 
                    onclick="castSpell(${spell.level})"
                    ${!isCastable ? 'disabled' : ''}
                    style="${!isCastable ? 'opacity:0.5' : ''}">
                    ${spell.level === 0 ? 'Usar' : 'Gastar'}
                </button>
                <button onclick="removeSpell(${index})" style="background:transparent; color:#555; font-size:1.2em; margin-left:5px;">&times;</button>
            `;
            list.appendChild(li);
        });
    }

    // --- Modal Logic ---
    function openModal() { document.getElementById('modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    
    function saveNewSpell() {
        const name = document.getElementById('new-spell-name').value;
        const level = parseInt(document.getElementById('new-spell-level').value);
        const desc = document.getElementById('new-spell-desc').value;

        if(name) {
            data.spells.push({
                id: Date.now(),
                name: name,
                level: level,
                desc: desc
            });
            saveData();
            closeModal();
            // Limpar inputs
            document.getElementById('new-spell-name').value = '';
            document.getElementById('new-spell-desc').value = '';
        } else {
            alert("Digite o nome da magia!");
        }
    }

    function removeSpell(index) {
        if(confirm("Remover esta magia do grim√≥rio?")) {
            data.spells.splice(index, 1);
            saveData();
        }
    }

    // Start
    init();

</script>

</body>
</html>
